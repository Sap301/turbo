const path=require("path"),fs=require("fs"),util=require("util"),appVersion=require("../package.json").version,readDir=util.promisify(fs.readdir),writeFile=util.promisify(fs.writeFile),readFile=util.promisify(fs.readFile);console.log("\nRunning post-build tasks");const versionFilePath=path.join(__dirname+"/../dist/ecommerce-portal-web/version.json");let mainHash="",mainBundleFile="",mainBundleRegexp=/^main.?([a-z0-9]*)?(\.bundle)?.js$/;readDir(path.join(__dirname,"../dist/ecommerce-portal-web/")).then(e=>{if(mainBundleFile=e.find(e=>mainBundleRegexp.test(e))){let e=mainBundleFile.match(mainBundleRegexp);e.length>1&&e[1]&&(mainHash=e[1])}return console.log(`Writing version and hash to ${versionFilePath}`),writeFile(versionFilePath,`{"version": "${appVersion}", "hash": "${mainHash}"}`)}).then(()=>{if(!mainBundleFile)return;console.log(`Replacing hash in the ${mainBundleFile}`);const e=path.join(__dirname,"../dist/ecommerce-portal-web/",mainBundleFile);return readFile(e,"utf8").then(i=>{const n=i.replace("{{POST_BUILD_ENTERS_HASH_HERE}}",mainHash);return writeFile(e,n)})}).catch(e=>{console.log("Error with post build:",e)});